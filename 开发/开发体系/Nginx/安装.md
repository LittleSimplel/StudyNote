### **安装依赖包**

```sh
//一键安装四个依赖
yum -y install gcc zlib zlib-devel pcre-devel openssl openssl-devel
```

### **下载并解压安装包**

```sh
//创建一个文件夹
cd /usr/local
mkdir nginx
cd nginx
//下载tar包
wget http://nginx.org/download/nginx-1.13.7.tar.gz  // 建议用高版本
tar -zxvf nginx-1.13.7.tar.gz
```

### **安装nginx**

```sh
cd nginx-1.13.7
//执行命令
./configure --with-http_ssl_module
//执行make命令
make
//执行make install命令
make install
```

环境变量

`vi /etc/profile`

```sh
export NGINX_HOME=/usr/local/nginx
export PATH=$PATH:$NGINX_HOME/sbin
```

`source /etc/profile`

### 启动

`nginx`

访问hostname:80

![nginx80.png](http://ww1.sinaimg.cn/large/0062TeRXgy1gdgmn3m1e9j30qu08odgi.jpg)

### 命令

启动 ： `nginx`

停止： `nginx -s stop`

重启： `nginx -s reload`

验证配置文件： `nginx -t`

### 平滑升级

下载新版nginx，nginx-1.23.1.tar.gz，上传解压。

- 将新版本编译，不需要进行安装

  ```shell
  进入安装目录
  ./configure
  make && make install
  ```

- **确保旧版本的nginx是进入到sbin下启动的，如果用环境变量nginx启动。先停止nginx，再进入到sbin下启动。**

- 将旧版本的sbin目录下的nginx进行备份

  ```java
  cd /usr/local/nginx/sbin
  mv nginx nginxold
  ```

- 将新版本安装目录编译后的objs目录下的nginx文件，拷贝到原来/usr/local/nginx/sbin目录下

  ```sehll
  [root@hadoop101 objs]# cp nginx /usr/local/nginx/sbin
  ```

- 进入到新版本安装目录，执行make upgrade

  ```shell
  [root@hadoop101 nginx-1.23.1]# make upgrade
  /usr/local/nginx/sbin/nginx -t
  nginx: the configuration file /usr/local/nginx/conf/nginx.conf syntax is ok
  nginx: configuration file /usr/local/nginx/conf/nginx.conf test is successful
  kill -USR2 `cat /usr/local/nginx/logs/nginx.pid`
  sleep 1
  test -f /usr/local/nginx/logs/nginx.pid.oldbin
  kill -QUIT `cat /usr/local/nginx/logs/nginx.pid.oldbin`
  ```

- 查看是否更新成功: 

  ```sh
  cd /usr/local/nginx/sbin
  ./nginx -v
  ```

**注意**：执行make upgrade 报错：

```sh
nginx: the configuration  file  /usr/local/nginx/conf/nginx .conf syntax is ok
nginx: configuration  file  /usr/local/nginx/conf/nginx .conf  test  is successful
kill  -USR2 ` cat  /usr/local/nginx/logs/nginx .pid`
sleep  1
test  -f  /usr/local/nginx/logs/nginx .pid.oldbin
make : *** [upgrade] 错误 1
```

解决：

```sh
1.停止nginx
  nginx -s stop
2.启动旧版本
  cd /usr/local/nginx/sbin
  ./nginxold
 // 注意不要用环境变量启动,进入到sbin下启动
3.进入到新版本安装目录，执行make upgrade
```



